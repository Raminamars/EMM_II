#–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: AR(p)

Ar <- function(n, theta) { # –§—É–Ω–∫—Ü–∏—è AR –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ (AR(1)).
  reg = numeric(n) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–ª–∏–Ω–æ–π n
  reg[1] = runif(1, min = 0, max = 1)# –ó–∞–¥–∞–µ–º –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ –∏–∑ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
  
  for(i in 2:n) {
    e = rnorm(1, 0, 1) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É –∏–∑ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
    reg[i] = reg[i - 1] * theta + e # –í—ã—á–∏—Å–ª—è–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ–º—É —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é
  }
  
  return(reg) # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
}

## 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ ùê¥ùëÖ(1), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π, –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ Œ∏
theta = 0.55
reg = Ar(2000,theta)
title = sprintf("theta = %f ",theta)
plot(reg,main = title ,type = c("l"), col="blue") # –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1) —Å theta = 0.55

theta = 1
reg = Ar(2000,theta)
title = sprintf("theta = %f ",theta)
plot(reg,main = title ,type = c("l"), col="blue")# –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1) —Å theta = 1

theta = -1
reg = Ar(500,theta)
title = sprintf("theta = %f ",theta)
plot(reg,main = title ,type = c("l"), col="blue") # –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1) —Å theta = -1

theta = 2
reg = Ar(100,theta)
title = sprintf("theta = %f ",theta)
plot(reg,main = title ,type = c("l"), col="blue") # –°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ AR(1) —Å theta = 2


## 2. –û—Ü–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä |ùúÉ| ‚â§ 1 –ø–æ –º–µ—Ç–æ–¥—É –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ (–ú–ù–ö).
n = 10000
theta = 0.55
reg = Ar(n,theta)
squaring_elem = numeric(n-1) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
sum_of_previous = numeric(n-1) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π —Ç–µ–∫—É—â–∏—Ö –∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
for(i in 2:n){
  squaring_elem[i] = reg[i-1]*reg[i-1] # –í—ã—á–∏—Å–ª—è–µ–º –∫–≤–∞–¥—Ä–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
  sum_of_previous[i] = reg[i]*reg[i-1] # –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π
}
theta_estimate_mnk = sum(sum_of_previous)/sum(squaring_elem) # –í—ã—á–∏—Å–ª—è–µ–º –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ theta
sprintf("theta = %f, MNK - –æ—Ü–µ–Ω–∫–∞ theta = %f",theta,theta_estimate_mnk) # –í—ã–≤–æ–¥–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ –∏ –æ—Ü–µ–Ω–µ–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π

## 3. –ù–∞–π—Ç–∏ –æ—Ü–µ–Ω–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è (–ú–ü) –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùúÉ –ø—Ä–æ—Ü–µ—Å—Å–∞ ùê¥ùëÖ(1).
n = 10000
MP = function(theta) { # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ —Ä–∞–∑–Ω–æ—Å—Ç–µ–π
  MP_elems = numeric(n-1)
  for (i in 2 : n) {
    MP_elems[i] = (reg[i] - theta * reg[i-1])**2
  }
  return (sum(MP_elems))
}
theta = 0.55
reg = Ar(n,theta)
interval = c(-10,10)
tetta_estimete_mp <- optimize(f = MP, lower = min(interval), upper = max(interval), # –ù–∞—Ö–æ–¥–∏–º –æ—Ü–µ–Ω–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –º–µ—Ç–æ–¥–æ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–∏—è
                              maximum = FALSE)$minimum
sprintf("theta = %f, MNK - –æ—Ü–µ–Ω–∫–∞ theta = %f, MP - –æ—Ü–µ–Ω–∫–∞ theta =  %f",theta,theta_estimate_mnk,tetta_estimete_mp )


## 4. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫–∏ –¥–ª—è –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëò = 10, 11, . . . , ùëõ. 
## –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∏–Ω–∞–º–∏–∫—É –æ—Ü–µ–Ω–∫–∏, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏, –∏ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã.
##      (a) –ó–∞–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å ùê¥ùëÖ(1) –æ–±—ä–µ–º–∞ –≤—ã–±–æ—Ä–∫–∏ ùëõ = 1000;
n = 1000
theta = 0.55
reg = Ar(n,theta)
##      (b) –†–∞—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–æ 10 –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞;
squaring_elem = numeric(9)
sum_of_previous = numeric(9)
for(i in 2:10){
  squaring_elem[i] = reg[i-1]*reg[i-1]
  sum_of_previous[i] = reg[i]*reg[i-1]  
}
theta_estimate_mnk_10 = sum(sum_of_previous)/sum(squaring_elem)
sprintf("theta = %f, MNK - –æ—Ü–µ–Ω–∫–∞ theta = %f",theta,theta_estimate_mnk_10)
##      (c) –†–∞—Å—á–∏—Ç–∞—Ç—å –ú–ù–ö-–æ—Ü–µ–Ω–∫—É –ø–æ 11 –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º –∏ —Ç.–¥. –¥–ª—è –≤—Å–µ—Ö ùëò = 10,11, . . . ,ùëõ;
observations = numeric(n-10)
observations[1] = theta_estimate_mnk_10
for(i in 11:n){
  squaring_elem = numeric(i-1)
  sum_of_previous = numeric(i-1)
  for(j in 2:i){
    squaring_elem[j] = reg[j-1]*reg[j-1]
    sum_of_previous[j] = reg[j]*reg[j-1]  
  }
  theta_estimate_mnk = sum(sum_of_previous)/sum(squaring_elem)
  observations[i-9] = theta_estimate_mnk
}
##      (d) –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ.
plot(observations,type = c("l"), col="blue")

## 5. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ ùê¥ùëÖ(2), –∏–∑ ùëõ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π.
Ar2 <- function(n, theta1, theta2) {
  reg = numeric(n)
  reg[1] = runif(1, min = 0, max = 1)
  reg[2] = runif(1, min = 0, max = 1)
  
  for(i in 3:n) {
    e = rnorm(1, 0, 1)
    reg[i] = reg[i - 2] * theta1 + reg[i - 1] * theta2 + e
  }
  return (reg)
}
n = 1000
theta1 = 0.51
theta2 = 0.27
reg = Ar2(n, theta1, theta2)
## –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ—Ü–µ—Å—Å ùê¥ùëÖ(2) –±—ã–ª —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –∫–æ—Ä–Ω–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è
## —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–ª–∏ —É—Å–ª–æ–≤–∏—é |ùúÜùëñ| < 1, ùëñ = 1, 2.
lamda1 = (theta1+sqrt(theta1*theta1 + 4*theta2))*0.5
lamda2 = (theta1-sqrt(theta1*theta1 + 4*theta2))*0.5

sprintf("–ö–æ—Ä–Ω–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏—è : lamda1 = %f, lamda2 = %f",lamda1,lamda2)
title = sprintf("theta = %f ",theta)
plot(reg,main = title ,type = c("l"), col="blue")

## 6. –í—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ ùê¥ùëÖ(2), –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é ùëéùëüùëñùëöùëé –ø–∞–∫–µ—Ç–∞ ùë†ùë°ùëéùë°
arima(reg, order = c(2, 0, 0), include.mean = FALSE)