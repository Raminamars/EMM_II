# 7 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –º–æ–¥–µ–ª—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

# ex.1 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 1000 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω ùëÅùë° –ø—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ùë° = 50, ùúÜ = 2;

t = 50 # –§–∏–∫—Å–∏—Ä—É–µ–º –≤—Ä–µ–º—è
lambda = 2 # –ó–∞–¥–∞–µ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –ø—É–∞—Å—Å–æ–Ω–æ–≤—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
Nt = numeric(1000) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è 1000 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π Nt
for(i in 1:1000){ # –¶–∏–∫–ª –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ 1000 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
  tau = numeric(i) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏
  j = 1 # –°—á–µ—Ç—á–∏–∫ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ –≤–µ–∫—Ç–æ—Ä–∞ tau
  while(sum(tau)<=t){ # –ü–æ–∫–∞ —Å—É–º–º–∞ –≤—Ä–µ–º–µ–Ω –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç t
    tau[j] = rexp(1,lambda) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Ä–µ–º—è –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º lambda
    j = j + 1 # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
  }
  Nt[i] = j # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π Nt –≤ –≤–µ–∫—Ç–æ—Ä
}
Nt # –í—ã–≤–æ–¥–∏–º –≤–µ–∫—Ç–æ—Ä —Å 1000 —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ Nt


# ex.2 –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ª–æ–∂–∏—Ç—å –Ω–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –≥—Ä–∞—Ñ–∏–∫ (13);

hist(Nt,freq=FALSE,col="green") # –°—Ç—Ä–æ–∏–º –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π Nt —Å –Ω–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç–æ–π
f_x = numeric(1000) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–∏ (13)
for(i in 1:1000){ # –¶–∏–∫–ª –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–∏ (13)
  f_x[i] = (lambda*t)^sort(Nt)[i]/factorial(sort(Nt)[i])*exp(-lambda*t) # –í—ã—á–∏—Å–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (13) –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ N_t
}
lines(sort(Nt),f_x,type="l",lwd=3,col="pink") # –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ —Ñ—É–Ω–∫—Ü–∏–∏ (13) –Ω–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É


# ex.3 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (12) –¥–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ ùë°ùëöùëéùë• –∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –≥—Ä–∞—Ñ–∏–∫.

U = function(t_max,U0,lambda,mu,c){ # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (12)
  ##  (a) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å.–≤. ùúè1, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ–ª–∏—á–∏–Ω–∞ ùëá1 = ùúè1;
  tau = c(rexp(1,lambda)) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏
  t = c(tau[1]) # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω, –Ω–∞—á–∏–Ω–∞—è —Å T1 = tau1
  ## (b) –í –º–æ–º–µ–Ω—Ç ùëá1 —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Å.–≤. ùëã1 –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤–µ–ª–∏—á–∏–Ω—É ùëàùëá1;
  X = c(rexp(1,1/mu)) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É X1
  U = c(U0 + c*tau[1]-X[1]) # –í—ã—á–∏—Å–ª—è–µ–º U_T1
  k = 1 # –°—á–µ—Ç—á–∏–∫ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞
  ##(f) –í –º–æ–º–µ–Ω—Ç ùëáùëõ, –∫–æ–≥–¥–∞ ‚àëÔ∏Äùëõ  ùëñ=1 ùúèùëñ ‚â• ùë°ùëöùëéùë• –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ–¥—É—Ä—É.
  while(sum(tau)<=t_max){ # –ü–æ–∫–∞ —Å—É–º–º–∞ –≤—Ä–µ–º–µ–Ω –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç t_max
    k = k + 1 # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫
    tau = c(tau,rexp(1,lambda)) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —Å–æ–±—ã—Ç–∏—è–º–∏
    ## (c) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å.–≤. ùúè2, –∫–æ—Ç–æ—Ä–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ–ª–∏—á–∏–Ω–∞ ùëá2 = ùúè1 + ùúè2;
    t = c(t,sum(tau)) # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è T_n
    X = c(X,rexp(1,1/mu)) # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å–ª—É—á–∞–π–Ω—É—é –≤–µ–ª–∏—á–∏–Ω—É X_n
    ##  (d) –í –º–æ–º–µ–Ω—Ç ùëá2 —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ —Å.–≤. ùëã2 –∏ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –≤–µ–ª–∏—á–∏–Ω—É ùëàùëá2 –ø—Ä–∏ —É–∂–µ
    ##  –∏–∑–≤–µ—Å—Ç–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ ùëàùëá1;
    U = c(U,U[k-1]+c*tau[k]-X[k]) # –í—ã—á–∏—Å–ª—è–µ–º U_T_n
  }
  return(data.frame(U,t)) # –í–æ–∑–≤—Ä–∞—â–∞–µ–º data.frame —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ U –∏ –≤—Ä–µ–º–µ–Ω–∞–º–∏ T
}

U0 = 50
t_max = 50
##(a) ùëà0 = 50, —É—Å–ª–æ–≤–∏–µ (15) –≤—ã–ø–æ–ª–Ω–µ–Ω–æ;
c = 2
lambda = 0.3
mu = 3
##—É—Å–ª–æ–≤–∏–µ (15)
r = c/(lambda*mu) - 1;r
u = U(t_max,U0,lambda,mu,c)
##(g) –í—ã–≤–æ–¥–∏–º –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –≥–¥–µ –ø–æ –æ—Å–∏ –∞–±—Å—Ü–∏—Å—Å –∏–¥—É—Ç –∑–Ω–∞—á–µ–Ω–∏—è ùëáùëñ,
##–∞ –ø–æ –æ—Å–∏ –æ—Ä–∏–Ω–∞—Ç ùëå –∑–Ω–∞—á–µ–Ω–∏—è ùëàùëáùëñ.
plot(u$t,u$U,type="o")

##(b) ùëà0 = 50, —É—Å–ª–æ–≤–∏–µ (15) –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.
c = 1
lambda = 0.7
mu = 5
##—É—Å–ª–æ–≤–∏–µ (15)
r = c/(lambda*mu) - 1;r
u = U(t_max,U0,lambda,mu,c)
plot(u$t,u$U,type="o")

# ex.4 –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Ñ–∏—Ä–º—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö
##–∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: ùë°ùëöùëéùë• = 1000, ùëê = 1, ùúÜ = 0.3, ùúá = 3, ùëà0 = 100, –ø–æ —Ñ–æ—Ä–º—É–ª–µ

n = 1000 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
t_max = 1000 # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
c = 1
lambda = 0.3
mu = 3
U0 = 100
summ = 0 # –°—á–µ—Ç—á–∏–∫ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–∞–∑–æ—Ä–µ–Ω–∏–π
for(i in 1:n){ # –¶–∏–∫–ª –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è n —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
  u = U(t_max,U0,lambda,mu,c) # –ú–æ–¥–µ–ª–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å U(t)
  if(min(u$U)<0) { # –ï—Å–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ U(t) –º–µ–Ω—å—à–µ 0, —Ç–æ —Ñ–∏—Ä–º–∞ —Ä–∞–∑–æ—Ä–∏–ª–∞—Å—å
    summ = summ + 1 # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ä–∞–∑–æ—Ä–µ–Ω–∏–π
  }  
}
psi1= (1/n)*summ; # –í—ã—á–∏—Å–ª—è–µ–º –≤—ã–±–æ—Ä–æ—á–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è
psi1

r = c/(lambda*mu) - 1;r
psi2 = exp((-1/mu)*r/(1+r)*U0); # –í—ã—á–∏—Å–ª—è–µ–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è
psi2
# psi1 < psi2 —É—Å–ª–æ–≤–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è

